<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aether Player</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #222; color: #eee; max-width: 900px; margin: 20px auto; padding-bottom: 150px; }
        a { color: #8af; text-decoration: none; }
        a:hover { text-decoration: underline; }
        ul { list-style-type: none; padding-left: 0; }
        li { margin-bottom: 10px; display: flex; align-items: center; padding: 10px; border-radius: 5px; }
        li:nth-child(odd) { background-color: #2a2a2a; }
        li:hover { background-color: #383838; }
        .icon { margin-right: 15px; font-size: 1.2em; }
        .action-button { margin-left: auto; background: #4a4; border: none; color: white; padding: 8px 12px; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; text-align: center; }
        .action-button.view-button { background-color: #44c; }
        .action-button.text-button { background-color: #c84; }
        .action-button.playing { background-color: #8a4; }
        #upload-section, #create-folder-section { background-color: #2a2a2a; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        #now-playing-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; padding: 15px; border-top: 1px solid #444; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .controls { display: flex; gap: 15px; align-items: center; }
        .control-button { background: #44c; border: none; color: white; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 1.2em; }
        #progress-container, #volume-container { width: 80%; max-width: 800px; display: flex; align-items: center; gap: 10px; }
        .slider { flex-grow: 1; width: 100%; cursor: pointer; }
        #progress-bar { 
            cursor: pointer; 
            height: 15px; 
            -webkit-appearance: none;
            appearance: none;
            background: #333; 
            border-radius: 10px;
            overflow: hidden;
            outline: none;
        }
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #4488ff;
            cursor: pointer;
            border: none;
            box-shadow: -410px 0 0 400px #4488ff;
        }
        #progress-bar::-moz-range-thumb {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #4488ff;
            cursor: pointer;
            border: none;
            box-shadow: -410px 0 0 400px #4488ff;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è touch-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (pointer: coarse) {
            #progress-bar::-webkit-slider-thumb {
                width: 24px;
                height: 24px;
            }
            #progress-bar::-moz-range-thumb {
                width: 24px;
                height: 24px;
            }
            #progress-bar {
                height: 24px;
            }
        }
    </style>
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h1>Aether Player</h1>
        <div style="display: flex; gap: 10px;">
            <a href="/audio-settings" class="control-button" style="background-color: #6a4c93; text-decoration: none; font-size: 0.9em;">
                üéµ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ
            </a>
            <a href="/monitor" class="control-button" style="background-color: #667eea; text-decoration: none; font-size: 0.9em;">
                üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
            </a>
        </div>
    </div>
    <h3>–¢–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞: /{{ current_subpath }}</h3>

    <!-- –°–µ–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–æ–∫ -->
    <div id="create-folder-section">
        <form id="create-folder-form">
            <input type="text" id="new-folder-name" placeholder="–ò–º—è –Ω–æ–≤–æ–π –ø–∞–ø–∫–∏" required>
            <button type="submit">–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</button>
        </form>
    </div>

    <!-- –§–∞–π–ª–æ–≤—ã–π –±—Ä–∞—É–∑–µ—Ä -->
    <ul>
        {% if parent_path is not none %}
        <li><span class="icon">‚§¥Ô∏è</span> <a href="{{ url_for('browse', subpath=parent_path) }}">.. (–ù–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ)</a></li>
        {% endif %}
        {% for folder in folders %}
        <li><span class="icon">üìÅ</span> <a href="{{ url_for('browse', subpath=current_subpath + '/' + folder if current_subpath else folder) }}">{{ folder }}</a></li>
        {% endfor %}
        {% for file in files %}
        <li>
            {% set file_path = current_subpath + '/' + file if current_subpath else file %}
            {% if file.lower().endswith(('.jpg', '.jpeg', '.png')) %} 
                <span class="icon">üñºÔ∏è</span>
                <span>{{ file }}</span>
                <!-- –û–ë–ù–û–í–õ–ï–ù–ò–ï: –°–Ω–æ–≤–∞ –∫–Ω–æ–ø–∫–∞, –∞ –Ω–µ —Å—Å—ã–ª–∫–∞ -->
                <button class="action-button view-button" data-filepath="{{ file_path }}">üëÅÔ∏è View</button>
            {% elif file.lower().endswith(('.txt', '.log', '.nfo', '.md', '.readme', '.info', '.cue', '.m3u', '.pls')) %}
                <span class="icon">üìÑ</span>
                <span>{{ file }}</span>
                <button class="action-button text-button" data-filepath="{{ file_path }}">üìñ –ß–∏—Ç–∞—Ç—å</button>
            {% else %}
                {% if file.lower().endswith(('.mkv', '.mp4', '.avi')) %} <span class="icon">üé¨</span> {% else %} <span class="icon">üéµ</span> {% endif %}
                <span>{{ file }}</span>
                <button class="action-button play-button" data-filepath="{{ file_path }}">‚ñ∂Ô∏è Play</button>
            {% endif %}
        </li>
        {% endfor %}
    </ul>

    <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <div id="upload-section">
        <h4>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É</h4>
        <form id="upload-form">
            <input type="file" id="file-input" multiple>
            <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </form>
        <div id="upload-progress-container"></div>
    </div>

    <!-- –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
    <div id="now-playing-bar">
        <div style="display: flex; justify-content: space-between; width: 100%; max-width: 800px;">
            <div id="now-playing-info"><strong>–°—Ç–∞—Ç—É—Å:</strong> –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
            <div id="audio-enhancement-info" style="color: #8af;"><strong>–°—Ç–µ—Ä–µ–æ:</strong> <span id="current-preset">–í—ã–∫–ª—é—á–µ–Ω–æ</span></div>
        </div>
        <div id="progress-container">
            <span id="current-time" data-time="0">00:00</span>
            <input type="range" id="progress-bar" class="slider" value="0" min="0" max="100" step="0.1">
            <span id="total-time" data-time="0">00:00</span>
        </div>
        <div class="controls">
            <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê PREVIOUS -->
            <button class="control-button" id="prev-button">‚èÆÔ∏è</button>
            <button class="control-button" id="play-pause-button">‚ñ∂Ô∏è</button>
            <button class="control-button" id="stop-button">‚èπÔ∏è</button>
            <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê NEXT -->
            <button class="control-button" id="next-button">‚è≠Ô∏è</button>
        </div>
        <div id="volume-container">
            <input type="range" id="volume-slider" class="slider" value="100" min="0" max="100">
            <span id="volume-percent">100%</span>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SocketIO –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        let socket = null;
        try {
            socket = io();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ-–ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
            socket.on('audio_enhancement_changed', function(data) {
                const presetElement = document.getElementById('current-preset');
                if (presetElement && data.preset_info) {
                    presetElement.textContent = data.preset_info.name;
                }
            });
        } catch (e) {
            console.log('SocketIO –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞');
        }
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>