#!/bin/bash
# Aether Player - –ú–ê–°–¢–ï–† –£–°–¢–ê–ù–û–í–©–ò–ö
# –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–∞—à–Ω–µ–≥–æ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
# –í–µ—Ä—Å–∏—è: 1.0 Production Ready

set -e

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

print_status() {
    echo -e "${BLUE}[–≠–¢–ê–ü]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[–ì–û–¢–û–í–û]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[–í–ù–ò–ú–ê–ù–ò–ï]${NC} $1"
}

print_error() {
    echo -e "${RED}[–û–®–ò–ë–ö–ê]${NC} $1"
}

print_step() {
    echo -e "${CYAN}[–®–ê–ì $1]${NC} $2"
}

print_header() {
    clear
    echo -e "${PURPLE}"
    cat << 'EOF'
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó 
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù

‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó 
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë  ‚ïö‚ñà‚ñà‚ïî‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù
EOF
    echo -e "${NC}"
    echo -e "${CYAN}üè† –î–û–ú–ê–®–ù–ò–ô –ú–£–ó–´–ö–ê–õ–¨–ù–´–ô –¶–ï–ù–¢–† - –ü–û–õ–ù–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê${NC}"
    echo "================================================================="
    echo -e "${GREEN}–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Raspberry Pi –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º—É–∑—ã–∫–∏${NC}"
    echo "================================================================="
    echo
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
check_prerequisites() {
    print_step "1" "–ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Raspberry Pi
    if grep -q "Raspberry Pi" /proc/cpuinfo 2>/dev/null; then
        print_success "Raspberry Pi –æ–±–Ω–∞—Ä—É–∂–µ–Ω"
    else
        print_warning "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å Raspberry Pi, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º..."
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if [[ $EUID -eq 0 ]]; then
        print_error "–ó–∞–ø—É—Å–∫ –æ—Ç root –∑–∞–ø—Ä–µ—â–µ–Ω! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."
        exit 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    if ping -c 1 google.com >/dev/null 2>&1; then
        print_success "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    else
        print_error "–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞."
        exit 1
    fi
    
    print_success "–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ"
}

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
interactive_setup() {
    print_step "2" "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"
    
    echo -e "${CYAN}–ù–∞—Å—Ç—Ä–æ–∏–º –≤–∞—à –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä:${NC}"
    echo
    
    # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
    read -p "üöÄ –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã? (Y/n): " -n 1 -r
    echo
    ENABLE_AUTOSTART=true
    if [[ $REPLY =~ ^[Nn]$ ]]; then
        ENABLE_AUTOSTART=false
    fi
    
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    read -p "üîç –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã? (Y/n): " -n 1 -r  
    echo
    ENABLE_MONITORING=true
    if [[ $REPLY =~ ^[Nn]$ ]]; then
        ENABLE_MONITORING=false
    fi
    
    # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
    read -p "üíæ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏? (Y/n): " -n 1 -r
    echo
    ENABLE_BACKUP=true
    if [[ $REPLY =~ ^[Nn]$ ]]; then
        ENABLE_BACKUP=false
    fi
    
    # –í–Ω–µ—à–Ω–∏–π –¥–∏—Å–∫
    echo
    print_warning "‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–∏—Å–∫–∞"
    echo "–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–Ω–µ—à–Ω–∏–π USB –¥–∏—Å–∫ –¥–ª—è –º—É–∑—ã–∫–∏, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –µ–≥–æ —Å–µ–π—á–∞—Å."
    echo "–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –µ–≥–æ –Ω–∞–π—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ."
    echo
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..." 
    
    print_success "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

# –û—Å–Ω–æ–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
run_main_installation() {
    print_step "3" "–û—Å–Ω–æ–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Aether Player"
    
    if [ -f "./install.sh" ]; then
        print_status "–ó–∞–ø—É—Å–∫–∞–µ–º –±–∞–∑–æ–≤—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É..."
        ./install.sh
    else
        print_error "–§–∞–π–ª install.sh –Ω–µ –Ω–∞–π–¥–µ–Ω!"
        exit 1
    fi
    
    print_success "–ë–∞–∑–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
setup_autostart() {
    if [ "$ENABLE_AUTOSTART" = true ]; then
        print_step "4" "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞"
        
        if [ -f "./setup-service.sh" ]; then
            print_status "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º systemd —Å–µ—Ä–≤–∏—Å..."
            ./setup-service.sh
        else
            print_error "–§–∞–π–ª setup-service.sh –Ω–µ –Ω–∞–π–¥–µ–Ω!"
            exit 1
        fi
        
        print_success "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    else
        print_step "4" "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–æ–ø—É—â–µ–Ω (–ø–æ –≤—ã–±–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)"
    fi
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
setup_monitoring() {
    if [ "$ENABLE_MONITORING" = true ]; then
        print_step "5" "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"
        
        if [ -f "./setup-monitoring.sh" ]; then
            print_status "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..."
            ./setup-monitoring.sh
        else
            print_error "–§–∞–π–ª setup-monitoring.sh –Ω–µ –Ω–∞–π–¥–µ–Ω!"
            exit 1
        fi
        
        print_success "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    else
        print_step "5" "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–ø—É—â–µ–Ω (–ø–æ –≤—ã–±–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)"
    fi
}

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –±—ç–∫–∞–ø–∞
create_initial_backup() {
    if [ "$ENABLE_BACKUP" = true ]; then
        print_step "6" "–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—è"
        
        if [ -f "./backup.sh" ]; then
            print_status "–°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
            ./backup.sh
        else
            print_error "–§–∞–π–ª backup.sh –Ω–µ –Ω–∞–π–¥–µ–Ω!"
            exit 1
        fi
        
        print_success "–ü–µ—Ä–≤—ã–π –±—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω"
    else
        print_step "6" "–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ (–ø–æ –≤—ã–±–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)"
    fi
}

# –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
final_system_check() {
    print_step "7" "–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã"
    
    sleep 3  # –î–∞–µ–º –≤—Ä–µ–º—è —Å–∏—Å—Ç–µ–º–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–∏—Å
    if systemctl is-active --quiet aether-player.service 2>/dev/null; then
        print_success "–°–µ—Ä–≤–∏—Å Aether Player –∑–∞–ø—É—â–µ–Ω"
    else
        print_warning "–°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ—Ç–∫–ª—é—á–µ–Ω)"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    LOCAL_IP=$(hostname -I | awk '{print $1}')
    if curl -s --connect-timeout 5 "http://$LOCAL_IP:5000" >/dev/null 2>&1; then
        print_success "–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω"
    else
        if [ "$ENABLE_AUTOSTART" = false ]; then
            print_warning "–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å–µ—Ä–≤–∏—Å –Ω–µ –∞–≤—Ç–æ–∑–∞–ø—É—â–µ–Ω)"
        else
            print_error "–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!"
        fi
    fi
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
    if [ -f "./monitor.sh" ] && [ "$ENABLE_MONITORING" = true ]; then
        print_status "–ó–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã..."
        ./monitor.sh --silent
    fi
    
    print_success "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
create_user_guide() {
    print_step "8" "–°–æ–∑–¥–∞–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    
    LOCAL_IP=$(hostname -I | awk '{print $1}')
    
    cat > "/home/$USER/aether-player/–†–£–ö–û–í–û–î–°–¢–í–û.txt" << EOF
üéµ AETHER PLAYER - –†–£–ö–û–í–û–î–°–¢–í–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
===========================================

–î–û–°–¢–£–ü –ö –ü–õ–ï–ï–†–£:
================
üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://$LOCAL_IP:5000
üì± QR-–∫–æ–¥: –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
üîó –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å: http://$(hostname).local:5000 (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è mDNS)

–£–ü–†–ê–í–õ–ï–ù–ò–ï:
===========
‚ñ∂Ô∏è  ./start.sh          - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–µ–µ—Ä –≤—Ä—É—á–Ω—É—é
‚èπÔ∏è  ./stop.sh           - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–µ–µ—Ä  
üîÑ ./restart.sh         - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–µ–µ—Ä
üìä ./status.sh          - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∏ –ª–æ–≥–∏

–ú–û–ù–ò–¢–û–†–ò–ù–ì:
===========
üîç ./monitor.sh         - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
üìà ./reports.sh         - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–†–ï–ó–ï–†–í–ù–´–ï –ö–û–ü–ò–ò:
================
üíæ ./backup.sh          - –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
üìÅ ~/aether-player/backups/ - –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏
üìÅ /mnt/music/aether-backups/ - –ö–æ–ø–∏–∏ –Ω–∞ –≤–Ω–µ—à–Ω–µ–º –¥–∏—Å–∫–µ (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)

–ú–ï–î–ò–ê –§–ê–ô–õ–´:
============
üìÇ ~/aether-player/media/ - –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –º—É–∑—ã–∫–∏
üéµ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP3, WAV, FLAC, M4A, OGG
üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: JPG, PNG, GIF, BMP

–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ SSH/SCP
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∫–Ω–æ–ø–∫–∞ Upload)
- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ USB –¥–∏—Å–∫ –∫ RPi

–°–ò–°–¢–ï–ú–ù–´–ï –ö–û–ú–ê–ù–î–´:
==================
sudo systemctl status aether-player    - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl start aether-player     - –ó–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl stop aether-player      - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å  
sudo systemctl restart aether-player   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo journalctl -u aether-player -f    - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

–£–°–¢–†–ê–ù–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú:
===================
‚ùì –ù–µ—Ç –∑–≤—É–∫–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–æ–≤ –∏ ./monitor.sh
‚ùì –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: sudo systemctl restart aether-player
‚ùì –ú–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: ./monitor.sh (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏ –ø–∞–º—è—Ç—å)
‚ùì –ü–æ—Ç–µ—Ä—è–Ω IP: ./monitor.sh –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å

–û–ë–ù–û–í–õ–ï–ù–ò–ï:
===========
cd ~/aether-player
git pull origin main
./restart.sh

–°–æ–∑–¥–∞–Ω–æ: $(date)
–í–µ—Ä—Å–∏—è: Aether Player v2.0.0 Production
EOF
    
    print_success "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–æ: ~/aether-player/–†–£–ö–û–í–û–î–°–¢–í–û.txt"
}

# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
generate_final_report() {
    print_step "9" "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"
    
    LOCAL_IP=$(hostname -I | awk '{print $1}')
    
    echo
    echo -e "${PURPLE}=================================================================${NC}"
    echo -e "${GREEN}üéâ –£–°–¢–ê–ù–û–í–ö–ê AETHER PLAYER –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û! üéâ${NC}"
    echo -e "${PURPLE}=================================================================${NC}"
    echo
    echo -e "${CYAN}üì° –î–û–°–¢–£–ü –ö –ü–õ–ï–ï–†–£:${NC}"
    echo -e "   üåê –í–µ–±-–∞–¥—Ä–µ—Å: ${GREEN}http://$LOCAL_IP:5000${NC}"
    echo -e "   üì± –° —Ç–µ–ª–µ—Ñ–æ–Ω–∞: –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä ‚Üí –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤—ã—à–µ"
    echo -e "   üíª –° –∫–æ–º–ø—å—é—Ç–µ—Ä–∞: –æ—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä ‚Üí –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å"
    echo
    echo -e "${CYAN}üìÅ –†–ê–°–ü–û–õ–û–ñ–ï–ù–ò–ï –§–ê–ô–õ–û–í:${NC}"
    echo -e "   üéµ –ú—É–∑—ã–∫–∞: ${GREEN}/home/$USER/aether-player/media/${NC}"
    echo -e "   üìã –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: ${GREEN}/home/$USER/aether-player/–†–£–ö–û–í–û–î–°–¢–í–û.txt${NC}"
    echo -e "   üíæ –ë—ç–∫–∞–ø—ã: ${GREEN}/home/$USER/aether-player/backups/${NC}"
    echo
    echo -e "${CYAN}üéõÔ∏è –£–ü–†–ê–í–õ–ï–ù–ò–ï:${NC}"
    if [ "$ENABLE_AUTOSTART" = true ]; then
        echo -e "   ‚úÖ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫: ${GREEN}–≤–∫–ª—é—á–µ–Ω${NC} (–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ RPi)"
    else
        echo -e "   ‚è∏Ô∏è –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫: ${YELLOW}–æ—Ç–∫–ª—é—á–µ–Ω${NC} (–∑–∞–ø—É—Å–∫–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é: ./start.sh)"
    fi
    
    if [ "$ENABLE_MONITORING" = true ]; then
        echo -e "   ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: ${GREEN}–≤–∫–ª—é—á–µ–Ω${NC} (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω)"
    else
        echo -e "   üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: ${YELLOW}–æ—Ç–∫–ª—é—á–µ–Ω${NC}"
    fi
    
    if [ "$ENABLE_BACKUP" = true ]; then
        echo -e "   ‚úÖ –ë—ç–∫–∞–ø—ã: ${GREEN}–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã${NC} (–ø–µ—Ä–≤—ã–π –±—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω)"
    else
        echo -e "   üíæ –ë—ç–∫–∞–ø—ã: ${YELLOW}–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã${NC}"
    fi
    
    echo
    echo -e "${CYAN}üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢:${NC}"
    echo -e "   1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É media/"
    echo -e "   2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ/–∫–æ–º–ø—å—é—Ç–µ—Ä–µ"
    echo -e "   3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: ${GREEN}http://$LOCAL_IP:5000${NC}"
    echo -e "   4. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –º—É–∑—ã–∫–æ–π! üéµ"
    echo
    echo -e "${CYAN}üìñ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:${NC}"
    echo -e "   üìö –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: ${GREEN}cat ~/aether-player/–†–£–ö–û–í–û–î–°–¢–í–û.txt${NC}"
    echo -e "   üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã: ${GREEN}ls ~/aether-player/*.sh${NC}"
    echo -e "   üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞: ${GREEN}https://github.com/EvgeniiiV/aether-player${NC}"
    echo
    echo -e "${PURPLE}=================================================================${NC}"
    echo -e "${GREEN}–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Aether Player! üôè${NC}"
    echo -e "${PURPLE}=================================================================${NC}"
    echo
}

# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    print_header
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ
    if [ ! -f "install.sh" ]; then
        print_error "–ú–∞—Å—Ç–µ—Ä-—É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ –ø–∞–ø–∫–∏ —Å –ø—Ä–æ–µ–∫—Ç–æ–º!"
        echo "–°–Ω–∞—á–∞–ª–∞ –∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:"
        echo "git clone https://github.com/EvgeniiiV/aether-player.git"
        echo "cd aether-player"
        echo "./setup-complete.sh"
        exit 1
    fi
    
    print_status "–ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –¥–æ–º–∞—à–Ω–µ–≥–æ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞..."
    echo
    
    # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—Å–µ —ç—Ç–∞–ø—ã
    check_prerequisites
    interactive_setup
    run_main_installation
    setup_autostart
    setup_monitoring  
    create_initial_backup
    final_system_check
    create_user_guide
    generate_final_report
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç
    echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: $(date)" > "/home/$USER/aether-player/.install-complete"
    echo "IP –∞–¥—Ä–µ—Å: $LOCAL_IP" >> "/home/$USER/aether-player/.install-complete"
    echo "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫: $ENABLE_AUTOSTART" >> "/home/$USER/aether-player/.install-complete"
    echo "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: $ENABLE_MONITORING" >> "/home/$USER/aether-player/.install-complete"
    echo "–ë—ç–∫–∞–ø—ã: $ENABLE_BACKUP" >> "/home/$USER/aether-player/.install-complete"
}

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
trap 'print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"; exit 1' INT TERM

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–∞—Å—Ç–µ—Ä-—É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
main "$@"
